---
title: "K3s의 구조에 대해 알아보자"
description: "홈랩에서 구동 하기 위한 준비 🫡"
date: 2024-10-26
---


# TL;DR

K8S의 경량화 버전인 K3S 구조에 대해 이해합니다.

# K3S란?

- K8S(쿠버네테스)의 경량화 버전입니다

## 차이점
- K3S가 지원하는 과거 API를 지원하지 않습니다.
- 쉘 스크립트로 한번에 설치가 가능합니다.
- 최대 5개 노드까지 무료입니다.

## 공통점
은 그냥 경량화 버전이라 거의 같다는 점입니다. 우리 ~~고철~~ 홈랩 서버에도 돌아간다는

설명은 쿠버네티스 기준으로 하겠습니다. 따라서, 일부 차이점이 있을 수 있습니다.

## 쿠버네티스는

- 여러 컨테이너 기반의 워크 로드를 효율적으로 관리할 수 있는 서비스입니다.
- 쿠버네티스는 완성되지 않은 서비스입니다
- 이유로는 여러 가지 PaaS 서비스들을 합쳐 갈 수 있음으로써 의미가 있기에입니다.
- 그리고, 이것의 기반이 되어주는 서비스 그 자체가 쿠버네티스입니다.

## 왜 필요한가?
프로덕션 상태의 애플리케이션의 컨테이너를 관리하는 역할을 맡았다고 해봅니다.
- 환경의 특성상, 오류가 나서 꺼져도 다시 켜야 할 것입니다. 마치 FailOver처럼요.
- 또한 로그 수집은 UX를 위해선 필수입니다.
- 시크릿키 구성도 필요할 거고
- 자원 설정도 맞춰서 해줘야 할 거고... 벌써 복잡합니다.

위 내용들을 쉽게 해주는 게 바로 쿠버네티스의 역할입니다.

---

## 구성요소
![컴포넌트](/posts/components-of-kubernetes.svg)

애플리케이션을 구성하는 백엔드 컨테이너 등을 모은 걸 파드라고 합니다.
이걸 노드라는 물리 머신에 쿠버네티스 워커 노드를 설치한 여러 곳에 뿌려두면 고가용성이 되는 것이고,
컨트롤 플레인은 이것들을 관리해 줍니다.

### 1. kube-apiserver

이 친구를 활용하여 서비스들을 관리할 수 있습니다. 그냥 API 백엔드에 엔드포인트 형태로 접속 느낌입니다.

### 2. etcd

이걸로 쿠버네티스의 데이터들을 저장합니다. K3S는 차이가 있던거 같습니다.

### 3. kube-scheduler 

노드가 지정되지 않은 파드를 배치 해줍니다. 여러가지 조건 하에 배치 될 노드를 구해줍니다.

### 4. kube-controller-manager

- 노드 컨트롤러: 노드가 다운되었을 때 통지와 대응에 관한 책임을 가집니다.
- 잡 컨트롤러: 일회성 작업을 나타내는 잡 오브젝트를 감시한 다음, 해당 작업을 완료할 때까지 동작하는 파드를 생성합니다.
- 엔드포인트슬라이스 컨트롤러: (서비스와 파드 사이의 연결고리를 제공하기 위해) 엔드포인트슬라이스(EndpointSlice) 오브젝트를 채웁니다
- 서비스어카운트 컨트롤러: 새로운 네임스페이스에 대한 기본 서비스어카운트(ServiceAccount)를 생성합니다.


### 5. cloud-controller-manager 

는 K3S이기도 하고, 로컬 서버(홈랩)에서 구동중이라 없습니다.

### 6. kubelet

워커든 마스터든 어디든 있어서 일을 맡는 선장이 됩니다.

### 7. kube-proxy

소프트웨어 기반의 방화벽이 있다면 해당 계층에서 컨테이너들이 통신 가능하게 해줍니다.   
없다면, 포워딩 해주는 역할을 합니다.


가볍게 정리하면 이정도이고, 세부적인 내용들은 프로덕션을 위해 배워둘 필요가 있을꺼 같다.

